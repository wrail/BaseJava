## Java的引用类型

### Java中引用类型是什么？

在 Java 中，除了原始数据类型的变量，其他所有都是所谓的引用类型。在前面中final中也提到过Java中的幻象引用，那下边就来揭开引用的神秘面纱。

### Java中的几类引用和用途

![在这里插入图片描述](https://img-blog.csdnimg.cn/20190401134545844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyNjA1OTY4,size_16,color_FFFFFF,t_70)

* 强引用：就是我们平时经常见到的对象引用，强引用的存在可以标志着被引用对象在活着的状态，这样在垃圾回收的时候就不会碰这个对象。

 *  保护在运行程序中不可少的对象

* 软引用：软引用的保护强度仅次于强引用，强引用不会让垃圾回收碰这个被引用的对象，但是软引用就相当于一个暂存区，暂存一些对象，如果JVM内存充足的话就不会回收这些引用，如果JVM在要抛出OutOfMemory前先清理软引用。

 *  软引用通常用来实现内存敏感的缓存，在内存空间存在空闲时会保留这些敏感内容，如果确定内存溢出就会对软引用进行回收。
 *  软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所引用的对象被垃圾回收，Java虚拟机就会把这个软引用加入到与之关联的引用队列中。

* 弱引用：不能让对象不被垃圾清理，仅仅是提供一种访问在弱引用状态下对象的途径。可以看作是一些可有可无的东西。如果系统需要这个弱引用对象的话，那就现在弱引用中找有没有途径，如果没找到就重新实例化。

 * 它可以用来维持一种引用关系（也就是说它只维持一个弱引用对象的途径） ，也是多缓存实现的选择。 
 * 弱引用可以和一个引用队列（ReferenceQueue）联合使用，如果弱引用所引用的对象被垃圾回收，Java虚拟机就会把这个弱引用加入到与之关联的引用队列中。

* 幻象引入：也叫虚引用，它不能用来访问对象，仅仅是提供一种对象被回收之后，做某些事情的机制。
 * 虚引用必须和引用队列（ReferenceQueue）联合使用。当垃圾回收器准备回收一个对象时，如果发现它还有虚引用，在回收对象的内存之前，把这个虚引用加入到与之关联的引用队列中。程序可以通过判断引用队列中是否已经加入了虚引用，来了解被引用的对象是否将要被垃圾
 回收。如果程序发现某个虚引用已经被加入到引用队列，那么就可以在所引用的对象的内存
 被回收之前采取一些程序行动。

 * 可用来跟踪对象被垃圾回收器回收的活动，当一个虚引用关联的对象被垃圾收集
器回收之前会收到一条系统通知。 

> 要知道在垃圾回收中，没有被引用的对象或超过作用域（超过作用域后就会给引用值赋值为null）就会被可以回收。

### 可达级别
* 强可达（Strongly Reachable），就是当一个对象可以有一个或多个线程可以不通过各种引用访问到的情况。比如，我们新创建一个对象，那么创建它的线程对它就是强可达。

* 软可达（Softly Reachable），就是当我们只能通过软引用才能访问到对象的状态。

* 弱可达（Weakly Reachable），类似前面提到的，就是无法通过强引用或者软引用访问，只能通过弱引用访问时的状态。这是十分临近 finalize 状态的时机，当弱引用被清除的时候，就符合 finalize 的条件了。

* 幻象可达（Phantom Reachable），上面流程图已经很直观了，就是没有强、软、弱引用关联，并且 finalize 过了，只有幻象引用指向这个对象的时候。

* 不可达（unreachable），意味着对象可以被清除

在上图中不仅画了向下转换的箭头也画了向上转换的箭头，那它是怎么实现的呢？

那就得介绍一下get方法了。它是在java.lang.ref.Reference 下的一个方法，上边所有的引用都是Reference的子类，Reference下就有一个方法那就是get方法。如果对象没被销毁，那就可以使用get方法得到对象。幻象引用使用get方法取得的对象为null。

> 什么是引用队列

我们在创建各种引用并关联到响应对象时，可以选择是否需要关联引用队列，JVM会在特定时机将引用enqueue到队列里，我们可以从队列里获取引用进行相关后续逻辑。幻象引用get 方法只返回 null，幻象引入必须加入到引用队列。